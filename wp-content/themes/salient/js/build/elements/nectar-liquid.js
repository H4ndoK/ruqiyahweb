!function(t){"use strict";function i(i,e,s){this.canvasContainer=i[0],this.rowBG=i,this.animationType=e,this.elType=s,this.bgDivWidth=t(this.rowBG).width(),this.bgDivHeight=t(this.rowBG).height(),this.bgDivRatio=this.bgDivHeight/this.bgDivWidth,PIXI.utils.skipHello(),this.app=new PIXI.Application({width:this.bgDivWidth,height:this.bgDivHeight,transparent:!0,sharedTicker:!0}),this.app.stage=new window.PIXI.Container,this.imgContainer=new window.PIXI.Container,t(this.canvasContainer).remove(".nectar-displacement"),t(this.canvasContainer).append('<div class="nectar-displacement"></div>'),this.displacementIMG_URL=t(this.canvasContainer).find(".nectar-displacement").css("background-image"),this.displacementIMG_URL=this.displacementIMG_URL.replace(/(url\(|\)|")/g,""),this.bgIMG_SRC=i.css("background-image"),this.bgIMG_SRC=this.bgIMG_SRC.replace(/(url\(|\)|")/g,""),this.loader=new PIXI.loaders.Loader,this.loader.add("rowBG",this.bgIMG_SRC),this.loader.add("displaceBG",this.displacementIMG_URL),this.loader.load(this.initialize.bind(this))}i.prototype.initialize=function(){var i,e,s,n;if(this.settings={animationStrength:1.5,animationStrengthSpeed:1,displacementScaleX:40,displacementScaleY:-80,time:20*Math.random(),filterMultX:200,filterMultY:350,duration:2400,shouldAnimate:!0},"displace-filter-fade"==this.animationType?(this.settings.filterMultX=150,this.settings.filterMultY=275,this.settings.displacementScaleX=70,this.settings.displacementScaleY=-70,this.settings.animationStrengthSpeed=.8,"row"!=this.elType&&(this.settings.duration=2e3,this.settings.displacementScaleX=50,this.settings.displacementScaleY=-50)):"row"!=this.elType&&(this.settings.displacementScaleY=70),this.filterSprite=new window.PIXI.Sprite(this.loader.resources.displaceBG.texture),this.filterSprite.texture.baseTexture.wrapMode=PIXI.WRAP_MODES.REPEAT,this.filter=new window.PIXI.filters.DisplacementFilter(this.filterSprite),this.bg=new PIXI.Sprite(this.loader.resources.rowBG.texture),this.imgHeight=this.loader.resources.rowBG.texture.orig.height,this.imgWidth=this.loader.resources.rowBG.texture.orig.width,this.imgRatio=this.imgWidth/this.imgHeight,this.bg.anchor.x=.5,this.bg.anchor.y=.5,this.bg.height=t(this.rowBG).height(),this.bg.width=this.imgRatio*this.bg.height,this.bg.width<=t(this.rowBG).width()?(this.bg.width=t(this.rowBG).width()+100,this.bg.height=this.bg.width/this.imgRatio):(this.bg.height=t(this.rowBG).height()+100,this.bg.width=this.imgRatio*this.bg.height),this.setAlignment(),this.app.renderer.resize(t(this.rowBG).width(),t(this.rowBG).height()),this.buildStage(),this.createFilters(),this.app.view.setAttribute("class","nectar-liquid-bg"),this.canvasContainer.appendChild(this.app.view),"displace-filter-loop"==this.animationType)0==t("#nectar_fullscreen_rows").length?(this.animateFilters(),i=t("#nectar_fullscreen_rows").length>0?"200%":"105%",s="row"==(e=this).elType?".row-bg-wrap":".column-image-bg-wrap",n=new Waypoint({element:t(this.canvasContainer).parents(s),handler:function(){e.imgContainer.addChild(e.bg)},offset:i})):(this.animateFilters(),this.imgContainer.addChild(this.bg));else if("displace-filter-fade"==this.animationType){this.animateFilters(),this.settings.shouldAnimate=!1,i=t("#nectar_fullscreen_rows").length>0?"200%":"85%",s="row"==(e=this).elType?".row-bg-wrap":".column-image-bg-wrap";var h=t("#nectar_fullscreen_rows[data-mobile-disable]").length>0?t("#nectar_fullscreen_rows").attr("data-mobile-disable"):"off";navigator.userAgent.match(/(Android|iPod|iPhone|iPad|BlackBerry|IEMobile|Opera Mini)/)||(h="off"),(0==t("#nectar_fullscreen_rows").length||t("#nectar_fullscreen_rows").length>0&&0==t(this.canvasContainer).parents(".wpb_row.fp-section").index()||"on"==h)&&(n=new Waypoint({element:t(this.canvasContainer).parents(s),handler:function(){t(e.canvasContainer).parents(".wpb_tab").length>0&&"hidden"==t(e.canvasContainer).parents(".wpb_tab").css("visibility")||t(e.canvasContainer).hasClass("animated-in")?n.destroy():(e.imgContainer.addChild(e.bg),e.animateProps(e),n.destroy())},offset:i}))}t(window).resize(this.resize.bind(this)),t(window).on("smartresize",this.resize.bind(this))},i.prototype.animateProps=function(i){setTimeout(function(){t(i.canvasContainer).find(".nectar-liquid-bg").addClass("animated-in"),i.settings.shouldAnimate=!0,i.settings.animationStrength=2,i.settings.animationStrengthSpeed=.8,i.animateFilters(),anime({targets:i.settings,animationStrength:0,duration:i.settings.duration,easing:[.26,.42,.4,1],complete:function(t){i.settings.shouldAnimate=!1}}),anime({targets:i.settings,animationStrengthSpeed:.3,duration:i.settings.duration,easing:[.26,.42,.4,1],complete:function(t){i.settings.shouldAnimate=!1}})},100)},i.prototype.setAlignment=function(){var i=t(this.rowBG).css("background-position-y"),e=t(this.rowBG).css("background-position-x");this.bg.position.y="top"===i||"0"===i||"0%"===i?(this.bg.height-t(this.rowBG).height())/2-40:"bottom"===i||"100"===i||"100%"===i?-(this.bg.height-t(this.rowBG).height())/2+40:0,this.bg.position.x="left"===e||"0"===e||"0%"===e?(this.bg.width-t(this.rowBG).width())/2-40:"right"===e||"100"===e||"100%"===e?-(this.bg.width-t(this.rowBG).width())/2+40:0},i.prototype.resize=function(){this.bgDivRatio=t(this.rowBG).height()/t(this.rowBG).width(),this.imgContainer.position.x=t(this.rowBG).width()/2,this.imgContainer.position.y=t(this.rowBG).height()/2,this.bg.height=t(this.rowBG).height(),this.bg.width=this.imgRatio*this.bg.height,this.bg.width<=t(this.rowBG).width()?(this.bg.width=t(this.rowBG).width()+100,this.bg.height=this.bg.width/this.imgRatio):(this.bg.height=t(this.rowBG).height()+100,this.bg.width=this.imgRatio*this.bg.height),this.app.stage.scale.x=this.app.stage.scale.y=1,this.setAlignment(),this.app.renderer.resize(t(this.rowBG).width(),t(this.rowBG).height())},i.prototype.createFilters=function(){this.app.stage.addChild(this.filterSprite),this.filter.scale.x=this.filter.scale.y=1,this.imgContainer.filters=[this.filter]},i.prototype.buildStage=function(){this.imgContainer.position.x=t(this.rowBG).width()/2,this.imgContainer.position.y=t(this.rowBG).height()/2,this.app.stage.scale.x=this.app.stage.scale.y=1,this.app.stage.addChild(this.imgContainer)},i.prototype.animateFilters=function(){"displace-filter-loop"===this.animationType?(this.filterSprite.rotation=.01*this.settings.time,this.filterSprite.x=Math.sin(.1*this.settings.time)*this.settings.filterMultX,this.filterSprite.y=Math.cos(.1*this.settings.time)*this.settings.filterMultY):(this.filterSprite.rotation=.04*this.settings.time,this.filterSprite.x=.1*this.settings.time*this.settings.filterMultX,this.filterSprite.y=.1*this.settings.time*this.settings.filterMultY),this.filter.scale.x=this.settings.displacementScaleX*this.settings.animationStrength,this.filter.scale.y=this.settings.displacementScaleY*this.settings.animationStrength,this.settings.time+=.05*this.settings.animationStrengthSpeed,"displace-filter-loop"==this.animationType?requestAnimationFrame(function(){this.animateFilters()}.bind(this)):"displace-filter-fade"==this.animationType&&this.settings.shouldAnimate&&requestAnimationFrame(function(){this.animateFilters()}.bind(this))},window.NectarLiquid=i}(jQuery);